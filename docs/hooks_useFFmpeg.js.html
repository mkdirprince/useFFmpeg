<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: hooks/useFFmpeg.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: hooks/useFFmpeg.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
var __awaiter = (this &amp;&amp; this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.useFFmpeg = void 0;
const react_1 = require("react");
const ffmpegSetup_1 = require("../lib/ffmpegSetup");
const errorHandler_1 = require("../utils/errorHandler");
const transcode_1 = require("../utils/transcode");
/**
 * Custom React hook for loading FFmpeg and performing file transcoding operations.
 *
 * Provides methods for initializing FFmpeg and transcoding files using FFmpeg once it is loaded.
 *
 * @returns {UseFFmpeg} An object containing:
 *   - `loaded` (boolean): Indicates whether FFmpeg is loaded and ready to use.
 *   - `loadFFmpeg(baseUrl?: string, mt?: boolean): Promise&lt;void>`: A function to load FFmpeg.
 *   - `transcode(file: File, outputFileFullName: string, cmdOptions?: string[]): Promise&lt;Buffer>`: A function to transcode files using FFmpeg.
 */
const useFFmpeg = () => {
    const [loaded, SetLoaded] = (0, react_1.useState)(false);
    const ffmpegRef = (0, react_1.useRef)(null);
    /**
     * Loads the FFmpeg library and sets it up for use.
     *
     * This function sets the `loaded` state to `false` while loading, and to `true` once the process completes successfully.
     *
     * @param {string} [baseUrl] - The optional base URL to load FFmpeg from.
     * @param {boolean} [mt] - Optional flag for enabling multithreading in FFmpeg.
     * @returns {Promise&lt;void>} Resolves when FFmpeg is successfully loaded.
     * @throws {Error} If FFmpeg fails to load, the error is passed to `errorHandler`.
     */
    const loadFFmpeg = (0, react_1.useCallback)((baseUrl, mt) => __awaiter(void 0, void 0, void 0, function* () {
        try {
            const ffmpegResponse = yield (0, ffmpegSetup_1.load)(baseUrl, mt);
            ffmpegRef.current = ffmpegResponse;
            SetLoaded(true);
        }
        catch (error) {
            (0, errorHandler_1.errorHandler)(error, "Error loading FFmpeg");
            SetLoaded(false);
        }
    }), []);
    /**
     * Transcodes a file using the loaded FFmpeg instance.
     *
     * This function processes the given input file and generates an output file with the specified name.
     * Additional FFmpeg command-line options can be provided for customization.
     *
     * @param {File} file - The input file to transcode.
     * @param {string} outputFileFullName - The full name of the transcoded output file.
     * @param {string[]} [cmdOptions] - Optional array of FFmpeg command-line options.
     * @returns {Promise&lt;Buffer>} Resolves with the transcoded file data as a buffer.
     * @throws {Error} If FFmpeg is not loaded or if an error occurs during transcoding.
     */
    const handleTranscode = (0, react_1.useCallback)((file, outputFileFullName, cmdOptions) => __awaiter(void 0, void 0, void 0, function* () {
        if (!loaded) {
            throw new Error("FFmpeg is not loaded");
        }
        return yield (0, transcode_1.transcode)(ffmpegRef.current, file, outputFileFullName, cmdOptions);
    }), [loaded]);
    return {
        loadFFmpeg,
        loaded,
        transcode: handleTranscode,
    };
};
exports.useFFmpeg = useFFmpeg;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#extractMimeType">extractMimeType</a></li><li><a href="global.html#load">load</a></li><li><a href="global.html#transcode">transcode</a></li><li><a href="global.html#useFFmpeg">useFFmpeg</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Tue Jan 14 2025 15:58:28 GMT+0000 (Greenwich Mean Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
